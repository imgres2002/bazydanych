CREATE TABLE postac(id_postaci INT AUTO_INCREMENT PRIMARY KEY,
nazwa VARCHAR(40),
rodzaj ENUM('wiking','ptak','kobieta'),
data_ur DATE,
wiek INT UNSIGNED);

INSERT INTO postac(rodzaj ,data_ur ,wiek ,nazwa ) VALUES (1,'1990-10-10',31,'Bjorn');

INSERT INTO postac(rodzaj ,data_ur ,wiek ,nazwa ) VALUES (2,'2010-10-10',11,'Drozd');

INSERT INTO postac(rodzaj ,data_ur ,wiek ,nazwa ) VALUES (3,'1960-10-10',61,'Tesciowa');

UPDATE postac SET data_ur='1933-10-10' WHERE nazwa='Tescowa';

UPDATE postac SET wiek=88 WHERE nazwa='Tescowa';

CREATE TABLE walizka(id_walizki INT PRIMARY KEY AUTO_INCREMENT,
pojemnosc INT UNSIGNED,
kolor ENUM('rozowy','czerwony','teczowy','zolty') DEFAULT 'rozowy',
id_wlasciciela INT,
FOREIGN KEY (id_wlasciciela) REFERENCES postac(id_postaci));

INSERT INTO walizka (pojemnosc,kolor,id_wlasciciela) VALUES (10,2,1);

INSERT INTO walizka (pojemnosc,kolor,id_wlasciciela) VALUES (10,4,3);

CREATE TABLE izba(adres_budynku INT AUTO_INCREMENT PRIMARY KEY,
nazwa_izby VARCHAR(40),
metraz INT UNSIGNED,
wlasciciel INT,
wlasciciel INT,
FOREIGN KEY (wlasciciel) REFERENCES postac(id_postaci));

ALTER TABLE izba ADD kolor VARCHAR(40) DEFAULT 'czarny' AFTER metraz;

INSERT INTO izba(nazwa_izby,metraz,wlasciciel) VALUES ('spizarnia',10,1);

CREATE TABLE przetwory(id_przetworu INT AUTO_INCREMENT PRIMARY KEY,
rok_produkcji DATE DEFAULT '1654-10-10',
id_wykonawcy INT,
FOREIGN KEY (id_wykonawcy) REFERENCES postac(id_postaci),
zawartosc VARCHAR(40),
dodatek VARCHAR(40) DEFAULT 'papryczka_chilli',
id_konsumenta INT,
FOREIGN KEY (id_konsumenta) REFERENCES postac(id_postaci));

INSERT INTO przetwory(id_wykonawcy,zawartosc,id_konsumenta) VALUES (1,'bigos',3);

INSERT INTO postac(rodzaj ,data_ur ,wiek ,nazwa ) VALUES (1,'1991-10-10',31,'wiking_1');
INSERT INTO postac(rodzaj ,data_ur ,wiek ,nazwa ) VALUES (1,'1992-10-10',31,'wiking_2');
INSERT INTO postac(rodzaj ,data_ur ,wiek ,nazwa ) VALUES (1,'1993-10-10',31,'wiking_3');
INSERT INTO postac(rodzaj ,data_ur ,wiek ,nazwa ) VALUES (1,'1994-10-10',31,'wiking_4');
INSERT INTO postac(rodzaj ,data_ur ,wiek ,nazwa ) VALUES (1,'1995-10-10',31,'wiking_5');

CREATE TABLE statek(nazwa_statku INT AUTO_INCREMENT PRIMARY KEY,rodzaj_statku ENUM('snek',' skeid','drakar'),data_wodowania DATE,max_ladownosc INT UNSIGNED);

INSERT INTO statek(rodzaj_statku,data_wodowania,max_ladownosc) VALUES (1,'1991-10-10',100);
INSERT INTO statek(rodzaj_statku,data_wodowania,max_ladownosc) VALUES (2,'1992-10-10',150);

ALTER TABLE postac ADD funkcja VARCHAR(40);

UPDATE postac SET funkcja='kapitan' WHERE nazwa='Bjorn';



ALTER TABLE postac ADD jaki_statek INT;
ALTER TABLE postac ADD FOREIGN KEY (jaki_statek) REFERENCES statek(nazwa_statku);

UPDATE postac SET jaki_statek=1 WHERE nazwa='Bjorn';
UPDATE postac SET jaki_statek=1 WHERE nazwa='Drozd';
UPDATE postac SET jaki_statek=2 WHERE nazwa='wiking_1';
UPDATE postac SET jaki_statek=2 WHERE nazwa='wiking_2';
UPDATE postac SET jaki_statek=2 WHERE nazwa='wiking_3';
UPDATE postac SET jaki_statek=2 WHERE nazwa='wiking_4';
UPDATE postac SET jaki_statek=2 WHERE nazwa='wiking_5';

DELETE FROM izba WHERE nazwa_izby='spizarnia';

DROP TABLE izba;

DELETE FROM postac WHERE nazwa='wiking_5';

DELETE FROM postac WHERE nazwa='wiking_4';

SHOW CREATE TABLE walizka;
ALTER TABLE walizka DROP FOREIGN KEY walizka_ibfk_1;
ALTER TABLE przwtwory DROP FOREIGN KEY przetwory_ibfk_2;
ALTER TABLE przwtwory DROP FOREIGN KEY przetwory_ibfk_1;
ALTER TABLE postac DROP COLUMN id_postaci;

ALTER TABLE postac ADD COLUMN pesel VARCHAR();
UPDATE postac SET pesel=1234567890 WHERE nazwa='Bjorn';
UPDATE postac SET pesel=1234567891 WHERE nazwa='Drozd';
UPDATE postac SET pesel=1234567892 WHERE nazwa='Tesciowa';
UPDATE postac SET pesel=1234567893 WHERE nazwa='wiking_1';
UPDATE postac SET pesel=1234567894 WHERE nazwa='wiking_2';
UPDATE postac SET pesel=1234567895 WHERE nazwa='wiking_3';
ALTER TABLE postac ADD PRIMARY KEY (pesel)

ALTER TABLE postac MODIFY rodzaj ENUM('wiking','ptak','kobieta','syrena');

INSERT INTO postac (nazwa,rodzaj,data_ur,wiek,pesel) VALUES ('Gertruda_Nieszczera',4,'1500-11-11',521,1234567896);

UPDATE postac SET jaki_statek=1 WHERE nazwa='Gertruda_Nieszczera';
UPDATE postac SET jaki_statek=1 WHERE nazwa='Tesciowa';

zad3?

ALTER TABLE postac MODIFY rodzaj ENUM('wiking','ptak','kobieta','syrena','waz');
INSERT INTO postac(nazwa,rodzaj,data_ur,wiek,pesel) VALUES ('Loko',5,'2020-12-12',1,1234567897);

create table marynarz like postac;
show create table postac;

ALTER TABLE marynarz ADD FOREIGN KEY (jaki_statek) REFERENCES statek(nazwa_statku);

INSERT INTO marynarz(nazwa,rodzaj ,data_ur ,wiek ,funkcja,jaki_statek,pesel) VALUES ('Bjorn','wiking','1990-10-10','31','kapitan',1,'1234567890');
INSERT INTO marynarz(nazwa,rodzaj ,data_ur ,wiek ,funkcja,jaki_statek,pesel) VALUES ('Drozd','ptak','1990-10-10','11','null',1,'1234567891');
INSERT INTO marynarz(nazwa,rodzaj ,data_ur ,wiek ,funkcja,jaki_statek,pesel) VALUES ('Tesciowa','kobieta','1933-10-10','88','null',1,'1234567892');
INSERT INTO marynarz(nazwa,rodzaj ,data_ur ,wiek ,funkcja,jaki_statek,pesel) VALUES ('Wiking_1','wiking','1991-10-10','31','null',2,'1234567893');
INSERT INTO marynarz(nazwa,rodzaj ,data_ur ,wiek ,funkcja,jaki_statek,pesel) VALUES ('Wiking_2','wiking','1992-10-10','30','null',2,'1234567894');
INSERT INTO marynarz(nazwa,rodzaj ,data_ur ,wiek ,funkcja,jaki_statek,pesel) VALUES ('Wiking_3','wiking','1993-10-10','29','null',2,'1234567895');
INSERT INTO marynarz(nazwa,rodzaj ,data_ur ,wiek ,funkcja,jaki_statek,pesel) VALUES ('Gertruda_Nieszczera','syrena','1500-11-11','521','null',1,'1234567896');

UPDATE marynarz SET jaki_statek=null;

DELETE FROM marynarz WHERE nazwa='Wiking_1';

DELETE FROM statek WHERE nazwa_statku=1;
DELETE FROM statek WHERE nazwa_statku=2;

ALTER TABLE postac DROP FOREIGN KEY postac_ibfk_1;
ALTER TABLE marynarz DROP FOREIGN KEY marynarz_ibfk_1;
drop table statek;

CREATE TABLE zwierz (id INT AUTO_INCREMENT PRIMARY KEY,
nazwa VARCHAR(40),
wiek INT);

INSERT INTO zwierz(nazwa,wiek) VALUES ('Drozd',11);
INSERT INTO zwierz(nazwa,wiek) VALUES ('Loko',1);

CREATE TABLE bieniaszewskis.kreatura LIKE wikingowie.kreatura;
CREATE TABLE zasob LIKE wikingowie.zasob;
CREATE TABLE ekwipunek LIKE wikingowie.ekwipunek;

INSERT INTO kreatura SELECT * from wikingowie.kreatura;
INSERT INTO zasob SELECT * from wikingowie.zasob;
INSERT INTO ekwipunek SELECT * from wikingowie.ekwipunek;

select AVG(waga) FROM kreatura WHERE rodzaj='wiking';
select AVG(waga), COUNT(rodzaj) FROM kreatura GROUP BY rodzaj;
select AVG(YEAR(dataUr)),rodzaj FROM  kreatura group BY rodzaj;

select SUM(waga),rodzaj FROM zasob group BY rodzaj;
select SUM(waga),nazwa FROM zasob WHERE ilosc >=4 GROUP BY nazwa;
select SUM(waga),nazwa FROM zasob WHERE ilosc >=4 GROUP BY nazwa HAVING SUM(waga)>10;
select COUNT(idZasobu),rodzaj FROM zasob WHERE ilosc>1 GROUP BY rodzaj;

zad3
SELECT idKreatury, SUM(ilosc) FROM ekwipunek GROUP BY idKreatury;
SELECT COUNT(ekwipunek.ilosc), kreatura.nazwa FROM ekwipunek, kreatura WHERE kreatura.idKreatury=ekwipunek.idKreatury GROUP BY kreatura.nazwa ;
ALBO
SELECT k1.nazwa, z1.nazwa FROM kreatura AS k1 JOIN ekwipunek AS e1 ON k1.idKreatury=e1.idKreatury JOIN zasob AS z1 ON z1.idZasobu+e1.idZasobu

SELECT k1.nazwa, COUNT(e1.ilosc) AS ilosc FROM kreatura AS k1 JOIN ekwipunek AS e1 ON k1.idKreatury=e1.idKreatury GROUP BY nazwa;

ZAD 4
1.
SELECT kreatura.nazwa , zasob.nazwa FROM kreatura JOIN ekwipunek ON kreatura.idkreatury=ekwipunek.idkreatury JOIN zasob ON ekwipunek.idZasobu=zasob.idZasobu WHERE year(dataUr)>1670 AND  year(dataUr)<1679
2.
SELECT kreatura.nazwa FROM kreatura JOIN ekwipunek ON kreatura.idkreatury=ekwipunek.idkreatury JOIN zasob ON ekwipunek.idZasobu=zasob.idZasobu WHERE zasob.rodzaj="jedzenie";
